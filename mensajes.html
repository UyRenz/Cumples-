
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mensajes Bonitos</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

  <style>
    /* ===== Fondo en pantalla ===== */
    body {
      background-image: url('https://images.unsplash.com/photo-1512389142860-9c449e58a543?auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ===== Fondo especial para impresi√≥n (se crea con un div) ===== */
    .bg-print {
      display: none; /* oculto en pantalla */
    }

    /* Ajustes visuales generales */
    .card, .alert {
      backdrop-filter: blur(4px);
      background-color: rgba(255, 255, 255, 0.85) !important;
    }

    .titulo-brillante {
      padding: 10px 20px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(4px);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.9);
      display: inline-block;
    }

    .subtitulo-brillante {
      padding: 6px 14px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(4px);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
      display: inline-block;
    }

    #tab-borrar {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 0, 0, 0.7);
      color: white;
      padding: 6px 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s ease;
      z-index: 9999;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #tab-borrar:hover {
      width: auto;
      height: auto;
      padding: 8px 16px;
      border-radius: 20px;
    }
    #tab-borrar span { display: none; margin-left: 6px; }
    #tab-borrar:hover span { display: inline; }

    /* PORTADA DE IMPRESI√ìN */
    .portada-impresion {
      display: none;
      text-align: center;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 12px;
    }
    .portada-impresion h1 { font-size: 40px; margin-bottom: 10px; }
    .portada-impresion p  { font-size: 18px; color: #555; }

    /* ENCABEZADO DE IMPRESI√ìN */
    .encabezado-impresion {
      display: none;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(248, 249, 250, 0.85);
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    /* FIRMA FINAL ‚Äî Opci√≥n A (cierre despu√©s de los mensajes) */
    .firma-final {
      display: none;               /* oculta en pantalla; se muestra en impresi√≥n */
      text-align: center;
      font-style: italic;
      color: #666;
      font-size: 12pt;             /* aspecto de cierre discreto */
    }

    /* Separador entre tarjetas (pantalla) */
    .card + .card {
      border-top: 2px dashed #ccc;
      margin-top: 20px;
      padding-top: 20px;
    }

    /* M√°rgenes est√°ndar del navegador en impresi√≥n */
    @page {
      margin: 20mm;
    }

    @media print {
      /* Indica al motor de impresi√≥n que respete colores/fondos */
      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* ===== Fondo para impresi√≥n =====
         Usamos un div fijo detr√°s del contenido
         para asegurar la imagen de fondo en todas las p√°ginas. */
      .bg-print {
        display: block;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        z-index: -1; /* detr√°s del contenido */
        background-image: url('https://images.unsplash.com/photo-1512389142860-9c449e58a543?auto=format&fit=crop&w=1350&q=80');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.15; /* leve para que no compita con el texto; ajusta a tu gusto */
      }

      body {
        background: none !important; /* quitamos el fondo del body, lo pone .bg-print */
        margin: 0 !important;
      }

      .container {
        padding: 0 !important;
        max-width: 100% !important;
      }

      /* Ocultar elementos que no van a impresi√≥n */
      #tab-borrar,
      button,
      .alert,
      .titulo-brillante,
      #formCard,
      .subtitulo-brillante {
        display: none !important;
      }

      /* Portada en la primera p√°gina, centrada con separaci√≥n superior */
      .portada-impresion {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 40mm);
        padding-top: 10mm;
        margin: 0;
        page-break-after: always;  /* luego pasa a los mensajes */
      }

      /* Encabezado para impresi√≥n */
      .encabezado-impresion {
        display: block !important;
        margin: 0 0 10mm 0;
        padding: 10mm 0 6mm 0;
        border-radius: 0;
        box-shadow: none;
        background: transparent;
      }

      /* Mensajes en una sola columna */
      #listaMensajes {
        display: block !important;
        padding: 0;
      }
      #listaMensajes .col-md-4 {
        width: 100% !important;
        margin-bottom: 20px;
      }
      .card {
        page-break-inside: avoid !important;
        border: 1px solid #ccc !important;
        background: rgba(253, 253, 253, 0.95) !important;
      }

      /* ‚Äî‚Äî FIRMA FINAL como cierre (sin nueva p√°gina) ‚Äî‚Äî */
      .firma-final {
        display: block !important;
        margin-top: 12mm;        /* separaci√≥n respecto a la √∫ltima tarjeta */
        page-break-before: auto; /* no fuerza salto de p√°gina */
        page-break-inside: avoid;
        break-inside: avoid;
      }
    }
  </style>
</head>

<body class="p-4">
  <!-- Fondo para impresi√≥n (solo visible en @media print) -->
  <div class="bg-print" aria-hidden="true"></div>

  <div class="container">

    <!-- PORTADA PARA IMPRESI√ìN -->
    <div class="portada-impresion">
      <h1>‚ú® Recuerdos del Equipo 2025 ‚ú®</h1>
      <p>Un a√±o lleno de aprendizajes, logros y mensajes que nos conectan.</p>
    </div>

    <!-- ENCABEZADO PARA IMPRESI√ìN -->
    <div class="encabezado-impresion">
      <h1>üì¨ Mensajes enviados</h1>
    </div>

    <!-- BOT√ìN BORRAR -->
    <div id="tab-borrar">‚û§ <span>Borrar mensajes</span></div>

    <!-- T√çTULO (pantalla) -->
    <div class="text-center">
      <h2 class="mb-4 titulo-brillante">‚ú® Un Espacio para Compartir ‚ú®</h2>
    </div>

    <!-- BOT√ìN IMPRIMIR (pantalla) -->
    <div class="text-center mb-4">
      <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir mensajes</button>
    </div>

    <!-- INSTRUCCIONES (pantalla) -->
    <div class="alert alert-danger p-4 shadow-sm" style="background: #fff5f5; border-left: 6px solid #d9534f;">
      <h4 class="mb-2">üìå Mensaje Especial para Todos</h4>
      <p>
        Sabemos que este a√±o ha estado lleno de retos, aprendizajes y momentos importantes para nuestro equipo.
        Queremos invitarte a compartir un mensaje especial para todos, algo que inspire, motive o simplemente saque una sonrisa.
        Tu mensaje ser√° parte de un recuerdo colectivo que celebra nuestro esfuerzo y uni√≥n en este cierre de a√±o. üéÑüéÅ
      </p>
    </div>

    <!-- FORMULARIO (pantalla; oculto en impresi√≥n) -->
    <div id="formCard" class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Escribe tu mensaje ‚úçÔ∏è</h5>
        <form id="formMensaje">
          <div class="mb-3">
            <label class="form-label">Tu nombre</label>
            <input id="nombre" type="text" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Tu mensaje</label>
            <textarea id="mensaje" class="form-control" rows="4" required></textarea>
          </div>
          <button class="btn btn-success" type="submit">Guardar mensaje</button>
        </form>
      </div>
    </div>

    <!-- SUBT√çTULO (pantalla) -->
    <h4 class="mb-3 subtitulo-brillante mt-4">üì¨ Mensajes enviados</h4>

    <!-- LISTA DE MENSAJES -->
    <div id="listaMensajes" class="row g-3"></div>

    <!-- FIRMA FINAL ‚Äî Opci√≥n A (cierre despu√©s de los mensajes) -->
    <div class="firma-final">
      üíñ Gracias por ser parte de este viaje. ¬°Vamos por m√°s en 2026!
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBxecz50StuiO64Qeh3hsM66JW0FAmy6GI",
      authDomain: "mensajes-cumple-51940.firebaseapp.com",
      projectId: "mensajes-cumple-51940",
      storageBucket: "mensajes-cumple-51940.firebasestorage.app",
      messagingSenderId: "680907658860",
      appId: "1:680907658860:web:1cd28e0ff2aaaf98d2ea49"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    document.getElementById("tab-borrar").addEventListener("click", function () {
      const codigo = prompt("Ingresa el c√≥digo para borrar los mensajes:");
      if (codigo === "997") {
        db.collection("mensajes").get().then(snapshot => {
          const batchDeletes = [];
          snapshot.forEach(doc => batchDeletes.push(doc.ref.delete()));
          return Promise.all(batchDeletes);
        }).then(() => alert("Todos los mensajes han sido borrados ‚úÖ"))
          .catch(err => console.error(err));
      } else if (codigo !== null) {
        alert("C√≥digo incorrecto ‚ùå");
      }
    });

    function cargarMensajes() {
      const lista = document.getElementById("listaMensajes");
      lista.innerHTML = "";

      const emojis = ["üéÑ","üéÖ","üéÅ","ü§∂","üß¶","üîî","üïØÔ∏è","‚ùÑÔ∏è","‚õÑ","üåü","üçæ","üç™","ü•≥","ü•Ç","üõ∑","üéÄ","üí´"];

      db.collection("mensajes").orderBy("fecha", "desc").onSnapshot(snapshot => {
        lista.innerHTML = "";
        snapshot.forEach(doc => {
          const m = doc.data();
          const emojiAleatorio = emojis[Math.floor(Math.random() * emojis.length)];

          const col = document.createElement("div");
          col.className = "col-md-4";

          const card = document.createElement("div");
          card.className = "card shadow-sm";

          const body = document.createElement("div");
          body.className = "card-body";

          const h5 = document.createElement("h5");
          h5.className = "card-title";
          h5.textContent = `${emojiAleatorio} ${m.nombre || ""}`;

          const p = document.createElement("p");
          p.className = "card-text";
          p.textContent = m.mensaje || "";

          body.appendChild(h5);
          body.appendChild(p);
          card.appendChild(body);
          col.appendChild(card);

          lista.appendChild(col);
        });
      });
    }

    document.getElementById("formMensaje").addEventListener("submit", function (e) {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      const mensaje = document.getElementById("mensaje").value.trim();

      if (!nombre || !mensaje) return;

      db.collection("mensajes").add({
        nombre,
        mensaje,
        fecha: Date.now(),
      });

      document.getElementById("formMensaje").reset();
    });

    cargarMensajes();
  </script>
</body>
</html>
